<!DOCTYPE html>
<html>
  <head>
    <title>Start me up!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!--
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    -->

    <link rel="stylesheet" type="text/css" href="/css/font-lato.css" />
    <link rel="stylesheet" type="text/css" href="/css/font-montserrat.css" />
    <link rel="stylesheet" type="text/css" href="/css/fontawesome-free-5.11.2.min.css" />
    <link rel="stylesheet" type="text/css" href="/css/noty.css" />
    <!--<link rel="stylesheet" type="text/css" href="/css/noty-themes/semanticui.css" />-->
    <link rel="stylesheet" type="text/css" href="/css/noty-themes/bulma.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
      integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
      crossorigin=""
    />

    <link rel="stylesheet" type="text/css" href="/css-app/start-me-up.css" />

    <script type="text/javascript" src="/js/jquery-3.4.1.min.js"></script>

    <script src="/js/noty.min.js" type="text/javascript"></script>

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script
      src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
      integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
      crossorigin=""
    ></script>

    <script type="text/javascript">
      $(document).ready(function() {
        // Check for click events on the navbar burger icon
        $(".navbar-burger").click(function() {
          // Toggle the "is-active" class on both the "navbar-burger" and the "navbar-menu"
          $(".navbar-burger").toggleClass("is-active");
          $(".navbar-menu").toggleClass("is-active");
        });

        const startupResources = [
          "Infrastructure",
          "Rent Spaces",
          "Co-Working",
          "Laboratory Space",
          "Coaching",
          "Accelerator",
          "Workshop",
          "Competition"
        ];
        const investorResources = ["Workshop", "Competition"];

        const map = L.map("mapid").setView([47.541232, 7.604589], 13);

        L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}", {
          attribution:
            'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
          maxZoom: 18,
          id: "mapbox/streets-v11",
          tileSize: 512,
          zoomOffset: -1,
          accessToken:
            "pk.eyJ1IjoidmljLWNvZGVjYW1wIiwiYSI6ImNrdGZueGZ1azBhMDYycG1yY2ZmNGJ4cWQifQ.xoYa6-TrQxRND1wHjGYkwg"
        }).addTo(map);

        const getPopupHTML = function(item) {
          const itemImage = `<p><figure class="image "><img src="${item.image}"></figure></p>`;
          const tagsHTML = `<p class="tags">${item.ressource.map(r => `<span class="tag">${r}</span>`).join(" ")}</p>`;

          const result = `<p><b><a href="${item.website}">${item.name}</a></b></p><p>${item.description}</p>${tagsHTML}`;

          return result;
        };

        $.getJSON("data.json", function(data) {
          console.log(data);

          const filterByResources = function(data, resources) {
            const result = [];

            for (let i = 0; i < data.length; ++i) {
              const item = data[i];
              for (let j = 0; j < resources.length; ++j) {
                if (item.ressource.includes(resources[j])) {
                  result.push(item);
                }
              }
            }

            return result;
          };

          const addMarkers = function(map, items) {
            const markers = [];

            for (let i = 0; i < items.length; ++i) {
              const item = items[i];

              const marker = L.marker(item.latlong)
                .addTo(map)
                .bindPopup(getPopupHTML(item))
                .openPopup();

              markers.push(marker);
            }

            return markers;
          };

          const clearMarkers = function(map, markers) {
            for (let i = 0; i < markers.length; ++i) {
              map.removeLayer(markers[i]);
            }
          };

          const onTitleSelectChange = function(e) {
            const selectedIndex = e.target.selectedIndex;
            clearMarkers(map, markers);

            if (selectedIndex === 0) {
              markers = addMarkers(map, filterByResources(data, startupResources));
            } else if (selectedIndex === 1) {
              markers = addMarkers(map, filterByResources(data, investorResources));
            }
          };

          $("#title-select select").change(onTitleSelectChange);

          // global
          var markers = addMarkers(map, filterByResources(data, startupResources));
        });

        /*
        new Noty({
          theme: "bulma",
          type: "{{notification.type}}",
          text: "{{notification.message}}",
          timeout: 3500
          // container: ".notification"
        }).show();
        */
      });
    </script>

    <script type="text/javascript">
      $(document).ready(function() {});
    </script>
  </head>

  <body>
    <div id="main-content-container">
      <nav class="navbar is-light has-shadow" role="navigation" aria-label="main navigation">
        <div class="container">
          <div class="navbar-brand">
            <a class="navbar-item" href="/">
              StartMeUp
              <!--
              <figure class="image">
                <img class="is-rounded" src="" height="30" width="30" />
              </figure>
              -->
            </a>

            <a
              role="button"
              class="navbar-burger burger"
              aria-label="menu"
              aria-expanded="false"
              data-target="navbarBasicExample"
            >
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </a>
          </div>

          <div id="" class="navbar-menu">
            <div class="navbar-start">
              <!--
              <a class="navbar-item" href="/">
                Home
              </a>
              -->
            </div>

            <div class="navbar-end">
              <div class="navbar-item">
                <span class="tag is-dark">
                  0.0.1
                </span>
              </div>
              <!--
              <div class="navbar-item">
                <form method="post" action="/login">
                  <div class="field is-grouped is-grouped-multiline">
                    <p class="control">
                      <input name="username" class="input" type="text" placeholder="username" />
                    </p>
                    <p class="control">
                      <input name="password" class="input" type="password" placeholder="password" />
                    </p>
                    <p class="control">
                      <button id="login" type="submit" class="button is-primary">
                        Login
                      </button>
                    </p>
                  </div>
                </form>
              </div>
              -->
            </div>
          </div>
        </div>
      </nav>

      <div id="main-content">
        <section class="hero is-light">
          <div class="hero-body">
            <div class="container has-text-centered">
              <h1 class="title">
                <span class="is-size-2 has-text-centered is-block">
                  We are a(n)
                  <div id="title-select" class="select">
                    <select id="">
                      <option value="startup">Startup</option>
                      <option value="investor">Investor</option>
                    </select>
                  </div>
                </span>
              </h1>
            </div>
          </div>
        </section>

        <section class="section">
          <div class="container">
            <div id="mapid" style="height: calc(100vh - 40vh);"></div>
          </div>
        </section>
      </div>
      <footer class="footer has-background-dark">
        <div class="container">
          <div class="columns">
            <div class="column">
              <p class="">
                <a href="https://github.com/baselhack/start-me-up"><i class="fab fa-github fa-fw fa-2x"></i></a>
              </p>
              <p class="has-text-light">Last updated: xxx</p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </body>
</html>
